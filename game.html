<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>6 & 7 Celebration ‚Äî Game</title>
<style>
  :root{--bg1:#160021;--bg2:#000}
  html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  body{background:radial-gradient(circle at center,var(--bg1) 0%,var(--bg2) 100%);overflow:hidden;user-select:none;cursor:crosshair}
  .digit{position:absolute;font-weight:900;pointer-events:none;animation:floatUp 4s ease-out forwards;-webkit-text-stroke:1px rgba(255,255,255,0.08);mix-blend-mode:screen;text-align:center}
  @keyframes floatUp{0%{transform:translateY(0) scale(1) rotate(0deg);opacity:1}100%{transform:translateY(-250px) scale(1.6) rotate(720deg);opacity:0}}
  .pattern{background-clip:text;-webkit-background-clip:text;color:transparent}
  body::before{content:"";position:fixed;inset:0;background:radial-gradient(circle at 50% 50%,rgba(255,255,255,0.04) 0%,transparent 70%);background-size:200% 200%;animation:shimmer 12s infinite linear;pointer-events:none}
  @keyframes shimmer{0%{background-position:0 0}100%{background-position:100% 100%}}

  /* UI */
  #playButton{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:40}
  #playButton button{font-size:28px;padding:18px 44px;border-radius:18px;border:none;background:linear-gradient(45deg,#6a0dad,#9b30ff,#ff00ff);color:#fff;cursor:pointer;box-shadow:0 0 24px #ff00ff,0 0 50px purple}
  #hud{position:fixed;left:18px;top:18px;color:#fff;font-weight:700;text-shadow:0 0 12px purple;z-index:30}
  #timer{position:fixed;right:18px;top:18px;color:#fff;font-weight:700;text-shadow:0 0 12px purple;z-index:30}
  #musicBtn{position:fixed;right:18px;bottom:18px;padding:10px 14px;border-radius:40px;border:none;background:linear-gradient(45deg,#8a2be2,#ff00ff,#ffd700);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 0 14px #ff00ff;z-index:30}
  #endScreen{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;flex-direction:column;color:#fff;font-size:22px;gap:16px;z-index:60;display:none}
  #endScreen button{padding:10px 16px;border-radius:10px;border:none;background:linear-gradient(45deg,#8a2be2,#ff00ff,#ffd700);color:#fff;cursor:pointer}
  .small{font-size:14px;opacity:0.9}

  /* responsiveness */
  @media (max-width:520px){.digit{font-size:28px}}
</style>
</head>
<body>
  <div id="enableOverlay" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:50">
    <button id="enableBtn" style="font-size:28px;padding:22px 48px;border-radius:999px;border:none;background:linear-gradient(45deg,#5a0ca8,#8a2be2);color:#fff;cursor:pointer;box-shadow:0 6px 40px rgba(138,43,226,0.45),0 0 80px rgba(150,50,255,0.15)">PRESS THE PURPLE BUTTON</button>
  </div>

  <div id="playButton" style="display:none"><button id="startBtn">PLAY</button></div>
  <div id="hud" style="display:none">Score: <span id="score">0</span> | High: <span id="high">0</span></div>
  <div id="timer" style="display:none">Time: <span id="time">60</span></div>
  <div id="instructions" style="display:none;position:fixed;left:50%;bottom:88px;transform:translateX(-50%);background:rgba(110,20,180,0.45);color:#fff;padding:8px 12px;border-radius:10px;z-index:35;font-weight:700">Drag to spawn ‚Äî 6/7 = 1pt, shapes/messages = 2pt</div>
  <button id="musicBtn" style="display:none">Music: OFF</button>
  <div id="debug" style="position:fixed;left:18px;bottom:18px;padding:8px 10px;background:rgba(0,0,0,0.45);color:#fff;border-radius:8px;font-size:13px;z-index:60;max-width:260px;line-height:1.3">debug: idle</div>

  <div id="endScreen"><div id="endMessage"></div><button id="replay">Play Again</button></div>

  <!-- follower that tracks the pointer while dragging -->
  <div id="follower" aria-hidden="true" style="position:fixed;left:0;top:0;width:36px;height:36px;border-radius:50%;pointer-events:none;transform:translate(-50%,-50%);background:radial-gradient(circle at 30% 30%,#ffffff55,transparent 40%),linear-gradient(45deg,#9b30ff,#5a0ca8);box-shadow:0 0 18px rgba(155,48,255,0.35),0 0 48px rgba(90,12,168,0.18);z-index:45;display:none"></div>

<script>
/* Single-file 6 & 7 Celebration Game
   - Click/tap to spawn bursts of 6/7 and rare items
   - Score updates (special items give more)
   - Timer, high score in localStorage
   - WebAudio produces playful variable melodies (multiple patterns)
*/

// Config
const COLORS = ['#b300ff','#9900ff','#cc00ff','#ff00ff','#ff69b4','#8a2be2','#4b0082','#9932cc','#ffb6c1','#ffd700','#daa520','#00ffee','#ff6600','#ff0080'];
const MESSAGES = ['Jesus loves you!','You are loved!','Be kind!','You matter!','Shine bright!'];
const HOLIDAYS = ['üéÑ','üéÉ','üéÜ','üéÇ','üéÅ','‚ùÑÔ∏è','üåü','üéâ'];
const SPECIAL = ['üíú','‚ù§Ô∏è','üéµ','üé∂','‚ú®'];
const ANIMAL = ['url("https://www.transparenttextures.com/patterns/leopard.png")','url("https://www.transparenttextures.com/patterns/zebra.png")','url("https://www.transparenttextures.com/patterns/giraffe.png")'];

// State
let tapCount = 0;
let score = 0;
let timeLeft = 60;
let gameActive = false;
let highScore = parseInt(localStorage.getItem('gv_highscore')||'0',10) || 0;

// Audio state
let audioCtx = null;
let masterGain = null;
let musicOn = false;
let loopHandle = null;
let currentPattern = null;

// UI refs
const startBtn = document.getElementById('startBtn');
const playPanel = document.getElementById('playButton');
const hud = document.getElementById('hud');
const timerEl = document.getElementById('timer');
const scoreEl = document.getElementById('score');
const highEl = document.getElementById('high');
const timeEl = document.getElementById('time');
const musicBtn = document.getElementById('musicBtn');
const endScreen = document.getElementById('endScreen');
const endMessage = document.getElementById('endMessage');
const replayBtn = document.getElementById('replay');

highEl.textContent = highScore;

// Utility: scoring & spawn
function addPoints(n){ score += n; if(score>highScore){ highScore = score; localStorage.setItem('gv_highscore', highScore); highEl.textContent = highScore; } scoreEl.textContent = score; }

function randomDigitOrSpecial(){
  tapCount++;
  // Slightly more frequent rares: trigger roughly every 4-9 taps
  if(tapCount % (2 + Math.floor(Math.random()*8)) !== 0) return Math.random()<0.5? '6':'7';
  const r = Math.random();
  if(r < 0.25) return HOLIDAYS[Math.floor(Math.random()*HOLIDAYS.length)];
  if(r < 0.5) return SPECIAL[Math.floor(Math.random()*SPECIAL.length)];
  if(r < 0.85) return '‚≠ê';
  return MESSAGES[Math.floor(Math.random()*MESSAGES.length)];
}

function createDigit(x,y){
  const el = document.createElement('span');
  el.className = 'digit';
  const content = randomDigitOrSpecial();
  el.textContent = content;
  el.style.left = x + 'px';
  el.style.top = y + 'px';
  el.style.fontSize = (Math.random()*70 + 20) + 'px';
  el.style.transform = `rotate(${Math.random()*360}deg)`;

  const chance = Math.random();
  if((content==='6' || content==='7') && chance<0.03){
    el.style.color = '#ffd700';
    el.style.textShadow = '0 0 25px #ffeb7b, 0 0 45px gold';
  } else if(chance < 0.9){
    const c = COLORS[Math.floor(Math.random()*COLORS.length)];
    el.style.color = c;
    el.style.textShadow = `0 0 10px ${c},0 0 25px ${c}`;
  } else {
    const p = ANIMAL[Math.floor(Math.random()*ANIMAL.length)];
    el.classList.add('pattern');
    el.style.backgroundImage = p;
    el.style.backgroundSize = 'contain';
    el.style.webkitBackgroundClip = 'text';
    el.style.color = 'transparent';
    el.style.filter = 'drop-shadow(0 0 10px purple)';
  }

  document.body.appendChild(el);
  setTimeout(()=>el.remove(),4200);

  // scoring
  if(content === '6' || content === '7') addPoints(1);
  else addPoints(2);
}

function spawnBurst(x,y,count=6){ for(let i=0;i<count;i++){ createDigit(x + (Math.random()-0.5)*200, y + (Math.random()-0.5)*200); } }

// Input handling + follower
let dragging = false;
const follower = document.getElementById('follower');
// require pressing the purple enable button before PLAY shows
const enableOverlay = document.getElementById('enableOverlay');
const enableBtn = document.getElementById('enableBtn');
enableBtn.addEventListener('click', () => {
  // hide the overlay and reveal play button
  enableOverlay.style.display = 'none';
  playPanel.style.display = 'flex';
  // show short instruction so user knows how to play
  const instr = document.getElementById('instructions');
  if (instr) instr.style.display = 'block';
  // unlock/init audio so music can start when toggled
  try { initAudio(); if (audioCtx && audioCtx.state === 'suspended' && audioCtx.resume) audioCtx.resume(); } catch (e) { /* ignore */ }
  // update play text in case high score changed
  updatePlayText && updatePlayText();
});

window.addEventListener('pointerdown', e => {
  console.log('pointerdown', e.clientX, e.clientY, 'gameActive=', gameActive);
  const dbg = document.getElementById('debug'); if(dbg) dbg.innerHTML = `pointerdown ${e.clientX},${e.clientY}<br>gameActive: ${gameActive}`;
  if (!gameActive) return; // only interact while game is active
  dragging = true;
  // show follower and position it
  if (follower) { follower.style.display = 'block'; follower.style.left = e.clientX + 'px'; follower.style.top = e.clientY + 'px'; }
  spawnBurst(e.clientX, e.clientY, 8);
});

window.addEventListener('pointerup', () => { dragging = false; if (follower) follower.style.display = 'none'; });

window.addEventListener('pointermove', e => {
  const dbg = document.getElementById('debug'); if(dbg) dbg.innerHTML = `pointer ${e.clientX},${e.clientY}<br>dragging: ${dragging}<br>gameActive: ${gameActive}<br>score: ${score}`;
  if (dragging && gameActive) {
    // spawn lighter bursts while dragging and move follower
    spawnBurst(e.clientX, e.clientY, 3);
    if (follower) { follower.style.left = e.clientX + 'px'; follower.style.top = e.clientY + 'px'; }
  }
});

// --- Audio: multiple patterns ---
const MUSIC_PATTERNS = [
  { // playful short
    melody:[392,392,440,392,523,494,392], rhythm:[0.28,0.28,0.36,0.28,0.36,0.6,0.6], harmony:[329.63,329.63,392,329.63,440,392,329.63], bass:[130.81,196,130.81,196,130.81,196,130.81]
  },
  { // twinkle-ish
    melody:[261.63,261.63,392,392,440,440,392], rhythm:[0.3,0.3,0.3,0.3,0.3,0.3,0.6], harmony:[196,196,329.63,329.63,349.23,349.23,329.63], bass:[130.81,130.81,196,196,130.81,196,130.81]
  },
  { // upbeat silly
    melody:[440,392,349.23,392,523,392,440], rhythm:[0.18,0.18,0.18,0.24,0.36,0.24,0.6], harmony:[329.63,293.66,261.63,293.66,440,293.66,329.63], bass:[110,130.81,110,130.81,110,130.81,110]
  },
  { // short loop
    melody:[329.63,329.63,349.23,392,392], rhythm:[0.28,0.28,0.28,0.28,0.56], harmony:[261.63,261.63,293.66,329.63,329.63], bass:[130.81,130.81,196,196,130.81]
  }
];

function initAudio(){ if(!audioCtx){ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); masterGain = audioCtx.createGain(); masterGain.gain.value = 0.35; masterGain.connect(audioCtx.destination); } }

function playMusicPattern(){ if(!musicOn) return; initAudio(); if(currentPattern === null) currentPattern = MUSIC_PATTERNS[Math.floor(Math.random()*MUSIC_PATTERNS.length)];
  let idx = 0;
  function tick(){ if(!musicOn) return; const p = currentPattern; const dur = p.rhythm[idx % p.rhythm.length];
    // melody
    const o1 = audioCtx.createOscillator(); const g1 = audioCtx.createGain(); o1.type='triangle'; o1.frequency.value = p.melody[idx % p.melody.length]; g1.gain.value = 0.12; o1.connect(g1).connect(masterGain); o1.start(); o1.stop(audioCtx.currentTime + dur);
    // harmony
    const o2 = audioCtx.createOscillator(); const g2 = audioCtx.createGain(); o2.type='sine'; o2.frequency.value = p.harmony[idx % p.harmony.length]; g2.gain.value = 0.06; o2.connect(g2).connect(masterGain); o2.start(); o2.stop(audioCtx.currentTime + dur);
    // bass (percussive)
    const o3 = audioCtx.createOscillator(); const g3 = audioCtx.createGain(); o3.type='square'; o3.frequency.value = p.bass[idx % p.bass.length]; g3.gain.value = 0.04; o3.connect(g3).connect(masterGain); o3.start(); g3.gain.setValueAtTime(0.04,audioCtx.currentTime); g3.gain.linearRampToValueAtTime(0,audioCtx.currentTime + Math.min(dur,0.18)); o3.stop(audioCtx.currentTime + Math.min(dur,0.2));
    idx = (idx + 1) % p.melody.length; loopHandle = setTimeout(tick, p.rhythm[idx % p.rhythm.length]*1000);
  }
  tick();
}
function stopMusic(){ musicOn = false; if(loopHandle) clearTimeout(loopHandle); loopHandle = null; currentPattern = null; if(audioCtx && audioCtx.suspend) audioCtx.suspend(); }

musicBtn.addEventListener('click', ()=>{
  if(!musicOn){ musicOn = true; musicBtn.textContent = 'Music: ON'; initAudio(); if(audioCtx.state === 'suspended' && audioCtx.resume) audioCtx.resume(); currentPattern = MUSIC_PATTERNS[Math.floor(Math.random()*MUSIC_PATTERNS.length)]; playMusicPattern(); }
  else{ musicBtn.textContent = 'Music: OFF'; stopMusic(); }
});

// Game lifecycle
let countdown = null;
function startGame(){ playPanel.style.display = 'none'; hud.style.display = 'block'; timerEl.style.display = 'block'; musicBtn.style.display = 'block'; score = 0; timeLeft = 60; tapCount = 0; gameActive = true; scoreEl.textContent = score; timeEl.textContent = timeLeft; endScreen.style.display = 'none'; // ensure audio unlocked
  initAudio();
  // hide instructions once the game actually starts
  const instr = document.getElementById('instructions'); if (instr) instr.style.display = 'none';
  // start countdown
  if(countdown) clearInterval(countdown);
  countdown = setInterval(()=>{ timeLeft--; timeEl.textContent = timeLeft; if(timeLeft<=0){ clearInterval(countdown); finishGame(); } },1000);
}
function finishGame(){ gameActive = false; // hide follower if visible
  if (follower) follower.style.display = 'none';
  endScreen.style.display = 'flex';
  // format end message with line breaks for clarity
  let m = `Time's up!<br><strong>Total points: ${score}</strong>`;
  if(score>highScore){ highScore = score; localStorage.setItem('gv_highscore', highScore); m += '<br>New High Score! üèÜ'; }
  else { m += `<br>High Score: ${highScore}`; }
  endMessage.innerHTML = m;
  // also update HUD/high displays
  scoreEl.textContent = score; highEl.textContent = highScore;
}
function restartGame(){ endScreen.style.display='none'; startGame(); }

replayBtn.addEventListener('click', restartGame);
startBtn.addEventListener('click', startGame);

// unlock audio on first gesture (mobile requirement)
function unlockAudio(){ initAudio(); if(audioCtx && audioCtx.state === 'suspended' && audioCtx.resume) audioCtx.resume(); window.removeEventListener('pointerdown', unlockAudio); }
window.addEventListener('pointerdown', unlockAudio);

// show high score on play button
function updatePlayText(){ const b = document.getElementById('startBtn'); if(b) b.textContent = `PLAY (High: ${highScore})`; }
updatePlayText();

</script>
</body>
</html>
